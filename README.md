#### å‰è¨€ï¼šæ­¤é¡¹ç›®çº¯å±ä¸ªäººå­¦ä¹ ç¼–å†™ï¼Œå¦‚æœ‰ä¸å¥½çš„åœ°æ–¹ï¼Œæ„è§ï¼Œåæ§½ç»™å°ç™½æˆ‘æŒ‡å‡ºã€‚ğŸ™

#### ä»‹ç»ï¼šè¿™ä¸ªé¡¹ç›®ä¸»è¦è¿˜æ˜¯å®ç°ç”¨ Excel å’Œ Json æ–‡ä»¶ç»“åˆåšçš„ä¸€ä¸ªæ•°æ®é©±åŠ¨ï¼Œå®ç°æ¥å£è‡ªåŠ¨åŒ–ã€‚







### æ“ä½œè¯´æ˜ï¼š

##### 

##### ä¸€ã€Excel æ¨¡ç‰ˆï¼š

**è¯´æ˜ï¼š**

â€‹    âš ï¸  Excel æ–‡ä»¶å¿…é¡»å­˜æ”¾åœ¨`app -> test_data ->case_data`ç›®å½•ä¸‹

â€‹    âš ï¸  Excel å†…æ¯ä¸€è¡Œä»£è¡¨ä¸€æ¡æµ‹è¯• case ï¼Œåˆ—åé¡ºåºä¸å›ºå®šï¼Œä½†æ˜¯æ¨¡ç‰ˆå†…çš„å›ºå®šåˆ—åå¿…é¡»å­˜åœ¨ã€‚

| ç”¨ä¾‹ç¼–å· | æµ‹è¯•ç›®çš„     | æµ‹è¯•æ¥å£                | è¯·æ±‚æ–¹æ³• | è¯·æ±‚æ•°æ®            | æ˜¯å¦æ‰§è¡Œ | æ˜¯å¦é€šè¿‡ |
| -------- | ------------ | ----------------------- | -------- | ------------------- | -------- | -------- |
| login_01 | ç”¨æˆ·æœ‰æ•ˆç™»å½• | /member/butler_login.do | POST     | login/test_login_01 | N        |          |

- **ç”¨ä¾‹ç¼–å·ï¼š** ç”¨ä¾‹ç¼–å·åœ¨åŒä¸€ä¸ª Excel å·¥ä½œç°¿ä¸­æ˜¯ä¸å¯é‡å¤çš„

- **æµ‹è¯•ç›®çš„ï¼š** ç”¨äºæè¿°æ­¤æ¡ case æ‰§è¡Œçš„ç›®çš„

- **æµ‹è¯•æ¥å£ï¼š** æµ‹è¯•æ¥å£çš„åœ°å€

- **è¯·æ±‚æ–¹æ³•ï¼š** `GET`ï¼Œ`POST`ï¼Œ`PUT`, `DELETE` ç­‰

- **è¯·æ±‚æ•°æ®ï¼š** æ­¤å¤„å¡«å†™çš„æ˜¯è¯¥æ¡ case å¯¹åº”çš„ json æ–‡ä»¶çš„åœ°å€ã€‚ç³»ç»Ÿé»˜è®¤è¯»å–çš„æ˜¯é¡¹ç›®çš„ `AutoTestAPI -> app -> test_data ->json_data` ç›®å½•ä¸‹çš„ json æ–‡ä»¶ã€‚

  ä¾‹å¦‚ï¼š `json_data -> login -> test_login_01.json` åªéœ€è¦å¡«å†™ `login/test_login_01`å³å¯
  
  ![image.png](https://upload-images.jianshu.io/upload_images/6213878-372c26270ac8d813.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)




- **æ˜¯å¦æ‰§è¡Œï¼š** `Y` ä»£è¡¨æ‰§è¡Œï¼Œ`N`ä»£è¡¨ä¸æ‰§è¡Œ

- **æ˜¯å¦é€šè¿‡ï¼š** TODO å› ä¸ºé¡¹ç›®æœ‰æŠ¥å‘Šè¾“å‡ºï¼Œå°±æ²¡æœ‰å»å®ç°äº†



##### äºŒã€Json æ–‡ä»¶æ¨¡ç‰ˆï¼š

âš ï¸  æ‰€æœ‰ä»‹ç»å­—æ®µå¯ä»¥ä¸º `null` ä½†æ˜¯éƒ½å¿…é¡»å­˜åœ¨ã€‚

âš ï¸  å˜é‡ä½¿ç”¨çš„ç»Ÿä¸€æ ¼å¼ä¸ºï¼š`{{ å˜é‡å }}`

**1. å­—æ®µä»‹ç»ï¼š**

- **url :** è¯·æ±‚æ¥å£çš„ `URL` é“¾æ¥ï¼Œ`URL` çš„`host` å¯ä»¥ä½¿ç”¨ `{{ url }}`å˜é‡è¿›è¡Œæ›¿æ¢

  è¯´æ˜ï¼š`{{ url }}`çš„å€¼å¯ä»¥åœ¨ `conf -> conf.yaml`æ–‡ä»¶å†…è¿›è¡Œé…ç½®ï¼Œæ–¹ä¾¿ç¯å¢ƒåˆ‡æ¢

- **method :**  è¯·æ±‚æ–¹æ³•

- **headers : ** è¯·æ±‚å¤´è®¾ç½®

  æ ·ä¾‹ï¼š

  ```json
  "headers": {
    "content-type": "application/json"
  },
  ```

- **rely_cases : ** ä¾èµ– `case` è®¾ç½®ï¼Œç”¨äºå‰ç½®æ¡ä»¶çš„æ‰§è¡Œï¼Œå¯ä»¥å°†å‰ç½®æ¡ä»¶çš„å“åº”æ•°æ®ï¼Œä½œä¸ºå˜é‡ä½¿ç”¨

  âš ï¸  `rely_cases` æ˜¯ä¸€ä¸ª` list`

  **å­—æ®µä»‹ç» ï¼š**

  - **case_id :**  å¡«å†™çš„æ˜¯ä¾èµ– Case çš„ç”¨ä¾‹ç¼–å·

    æ ¼å¼:`å·¥ä½œç°¿åç§°.ç”¨ä¾‹ç¼–å·` ,å­˜åœ¨åˆ†éš”ç¬¦`.`

    ä¾‹å¦‚: `Login.login_01`

  - **fields :** ä¾èµ– case çš„å­—æ®µï¼Œå­—æ®µçš„å€¼å¡«å†™çš„æ˜¯åŒ¹é…è¡¨è¾¾å¼ï¼Œæ”¯æŒï¼š`jsonpath` å’Œ `æ­£åˆ™è¡¨è¾¾å¼`

    æ ·ä¾‹ï¼š

    ```json
    "rely_cases": [
      {
        "case_id": "Login.login_01",
        "fields": {
          "username": "$.username",
          "password": "$.password"
        }
      },
      {
        "case_name": "login_02",
        "fields": null
      }
    ]
    ```

    å­—æ®µè¦åœ¨æ•°æ®ä¸­ä½¿ç”¨ï¼Œç›´æ¥ `{{ å­—æ®µå }}`å³å¯ï¼Œç³»ç»Ÿä¼šæ›¿æ¢åŒ¹é…çš„æ•°æ®

    

- **body :** è¯·æ±‚æ•°æ®

- **files :** ç”¨äºæ–‡ä»¶ä¸Šä¼ æ¥å£ï¼Œä¸ä½¿ç”¨çš„æ—¶å€™å¯ä»¥å€¼ä¸º `null`

  æ ·ä¾‹ï¼š

  ```json
  "files": {
    "file1": "image_01.png",
    "file2": "ä¸Šä¼ æ–‡ä»¶çš„åœ°å€ï¼Œæ–‡ä»¶å¿…é¡»å­˜æ”¾åœ¨ test_data -> files ç›®å½•ä¸‹"
  }
  ```

- **asserts :**  ç”¨äºæµ‹è¯•åæ–­è¨€

  ```json
  "asserts": {
    "code": 200, 											//	å“åº”çŠ¶æ€
    "$.username": "13681950786",      //  key ä¸º jsonpath è¡¨è¾¾å¼ï¼Œvalue æ˜¯éœ€è¦æ–­è¨€çš„å€¼
    "isContains": "hello"             //  ä»£è¡¨çš„æ˜¯å“åº”æ•°æ®å½“ä¸­æ˜¯å¦åŒ…å« `hello` è¿™ä¸ªå€¼
  }
  
  -- è¯´æ˜ï¼š éœ€è¦å…¶å®ƒæ–­è¨€æ–¹å¼ï¼Œæˆ–è€…æ–­è¨€å…¶å®ƒæ•°æ®ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚åœ¨æ–¹æ³•å†…æ‰©å±•
  ```

- **db_config :** ç”¨äºæ•°æ®åº“è¿æ¥é…ç½®ï¼Œå› ä¸ºæ¶‰åŠåˆ°ä¸åŒçš„ `case` æ“ä½œçš„æ•°æ®åº“ä¸åŒï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ­¤å¤„å•ç‹¬é…ç½®è¿æ¥

  âš ï¸ é¡¹ç›®ç°é˜¶æ®µåªæ”¯æŒ `mysql` è¿æ¥

  âš ï¸ è¯¥å­—æ®µæ˜¯å…è®¸ä¸º  `null` çš„ï¼Œä»–ä¼šé»˜è®¤è¯»å– `conf -> conf.yaml` é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®

   **å­—æ®µä»‹ç»**ï¼š

  â€‹	æ¯”è¾ƒçµæ´»çš„æ˜¯ï¼Œä¹‹åéœ€è¦é…ç½®å…¶å®ƒæ•°æ®åº“çš„è¯ï¼Œè¿æ¥æ–¹å¼ä¸ä¸€è‡´ï¼Œå¯ä»¥æ ¹æ®ä¸åŒå­—æ®µè®¾ç½®

  - **db_type :** æ•°æ®åº“ç±»å‹

  - **username :**  ç”¨æˆ·å

  - **password :** å¯†ç 

  - **host :**  è¿æ¥çš„åŸŸå

    

- **after :** ç”¨äºè¿™æ¡ case æ‰§è¡Œç»“æŸåçš„å–„åå·¥ä½œï¼Œä¾‹å¦‚è„æ•°æ®åˆ é™¤

  **å­—æ®µä»‹ç» ï¼š**
  
  - **veriables :**  æå–å“åº”ç»“æœçš„å­—æ®µå€¼ï¼Œå¹¶ä»¥å˜é‡çš„æ–¹å¼ä½¿ç”¨
  
    æ ·ä¾‹ï¼š
  
    ```
    "variables": {
      "user_id": "$.id",
      "user_name": "$.name",
      "user_key": "^h(*.?)o"
    }
    
    ```
  
  - **db_executes :** æ‰§è¡Œ`sql`è¯­å¥
  
    æ ·ä¾‹ï¼š
  
    ```js
    "db_executes": [
      {
        "name": "data_base",   // æŒ‡å®šéœ€è¦æ‰§è¡Œçš„æ•°æ®åº“
        "sql": [  						 // æ‰§è¡Œçš„ sql é›†åˆ
          "select * from User where name = {{ user_name }}", //å˜é‡çš„ä½¿ç”¨
          "select * from User where id = {{ user_id }}",
          "select * from User where key = {{ user_key }}"
        ]
      },
      {
        "name": "data_base",
        "sql": [
          "select * from User where name = {{ user_name }}",
          "select * from User where id = {{ user_id }}",
          "select * from User where key = {{ user_key }}"
        ]
      }
    ]
    ```





##### ä¸‰ã€æ‰§è¡Œ Case 

1. è¿›å…¥é¡¹ç›®çš„ `test` ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

   ```python
   pytest --alluredir=../report/allure_results
   ```

2. æˆ–è€…ç›´æ¥åœ¨ `test_run.py` ç›´æ¥æ‰§è¡Œ

   

##### å››ã€æŠ¥å‘Šå±•ç¤º

â€‹	ä¸€èˆ¬ case æ‰§è¡Œå®Œæˆä»¥åï¼Œä¼šåœ¨ `report/allure_results` ä¸­ç”ŸæˆæŠ¥å‘Šæ•°æ®

â€‹    æ‰§è¡Œå‘½ä»¤ï¼š

```python
>>> allure serve report/allure_results

Generating report to temp directory...
Report successfully generated to /var/folders/sy/bxf_1_yn06s7sm2yzm97r2b80000gn/T/7447734840827014947/allure-report
Starting web server...
2019-06-28 14:39:20.885:INFO::main: Logging initialized @2633ms to org.eclipse.jetty.util.log.StdErrLog
Server started at <http://127.0.0.1:55969/>. Press <Ctrl+C> to exit
```

è¿è¡Œåæµè§ˆå™¨å°±ä¼šé»˜è®¤æ‰“å¼€æŠ¥å‘Šåœ°å€ï¼š

![image.png](https://upload-images.jianshu.io/upload_images/6213878-083594040b61bade.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



#### äº”ã€ é¡¹ç›®ä¸­æœ‰ flask å†™çš„å°æ¥å£ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•ç©ç©ğŸ˜‚

| URL                                          | METHOD | description    |
| -------------------------------------------- | ------ | -------------- |
| http://localhost:5000/getUserPassword        | GET    | è·å–ç”¨æˆ·åå¯†ç  |
| http://localhost:5000/member/butler_login.do | POST   | æ¨¡ä»¿ç™»é™†æ¥å£   |
| http://localhost:5000/upload/image | POST |æ¨¡ä»¿ä¸Šä¼ æ¥å£|



###### é¡¹ç›®å¤§ä½“åŠŸèƒ½å°±è¿™äº›å•¦ï¼Œæœ‰ä¸è¶³å’Œæ„è§è¿˜æœ‰åæ§½ï¼Œéƒ½å¯ä»¥ç»™å°ç™½æˆ‘æŒ‡å‡ºï¼Œè¿›æ­¥å°±é å¤§ä½¬ä»¬äº†ğŸ™

------

